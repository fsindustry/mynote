Oracle数据库维护和管理解决方案
建立在Oracle数据库基础上的关键业务系统，是当今企业的核心应用；如何维护数据库系统的可靠性，提高应用系统的性能，是每个数据库管理员以至企业决策者都非常关心的问题。
数据库维护和管理的挑战包括：
性能
由于缺少有效的工具，很难了解数据库的运行状态。出现，也很难判断其根源，更无法快速将其解决。
可靠性
可靠性和高可用性对关键业务非常重要。影响可用性的因素，既可是空间不足或其它系统故障，也可能是正常的维护工作(如碎片重组)。
可维护性
可维护性包括如何降低维护工作量，简化维护过程，并提高DBA的管理水平。

为了迎接上述挑战，数据库管理人员必须建立起包括问题发现、故障诊断、问题解决和日常维护在内的完整的数据库性能及可用性管理流程，并借助相关管理工具，实现管理职能。
问题发现
首先，数据库管理员需要利用各种不同的工具和方法，发现和预测数据库中可能出现的问题。具体操作包括对系统和数据库状态信息收集，以及相关性分析和门限值比较，并在此基础上判断系统目前的状况。
故障诊断
一旦发现问题或潜在的故障因素，管理人员就必须进行更加深入的分析，确定产生这些问题的根本原因。分析过程中可能要深入考查包括Oracle例程、SQL、数据库逻辑存储、I/O等在内的诸多因素。
问题解决
高水平的管理人员可以手工解决大量的数据库性能和可用性问题。即便如此，这一过程也会花去他们很多精力，而且非常容易出现人为错误。借助相应的管理工具，以及这些工具中内置的专家建议，可以大大降低对管理人员的技能要求，工作效率也会大幅提高。
日常维护
建立良好的维护和管理机制，通常日常的管理工作改善数据库系统的性能和可用性，避免性能问题出现，是数据库管理人员基本的职能。管理工具的采用会大大简化这一工作。



在Oracle数据库运行期间，DBA应该对数据库的运行日志及表空间的使用情况进行监控，及早发现数据库中存在的问题。 

一、Oracle警告日志文件监控 

Oracle在运行过程中，会在警告日志文件(alert_SID.log)中记录数据库的一些运行情况: 

●数据库的启动、关闭，启动时的非缺省参数; 

●数据库的重做日志切换情况，记录每次切换的时间，及如果因为检查点(checkpoint)操作没有执行完成造成不能切换，会记录不能切换的原因; 

●对数据库进行的某些操作，如创建或删除表空间、增加数据文件; 

●数据库发生的错误，如表空间不够、出现坏块、数据库内部错误(ORA-600) 

DBA应该定期检查日志文件，根据日志中发现的问题及时进行处理 

问题处理 

启动参数不对检查初始化参数文件 

因为检查点操作或归档操作没有完成造成重做日志不能切换如果经常发生这样的情况，可以考虑增加重做日志文件组;想办法提高检查点或归档操作的效率; 

有人未经授权删除了表空间检查数据库的安全问题，是否密码太简单;如有必要，撤消某些用户的系统权限 

出现坏块检查是否是硬件问题(如磁盘本生有坏块)，如果不是，检查是那个数据库对象出现了坏块，对这个对象进行重建 

表空间不够增加数据文件到相应的表空间 

出现ORA-600根据日志文件的内容查看相应的TRC文件，如果是Oracle的bug，要及时打上相应的补丁 

二、数据库表空间使用情况监控(字典管理表空间) 

数据库运行了一段时间后，由于不断的在表空间上创建和删除对象，会在表空间上产生大量的碎片，DBA应该及时了解表空间的碎片和可用空间情况，以决定是否要对碎片进行整理或为表空间增加数据文件。 

select tablespace_name, 
count(*) chunks , 
max(bytes/1024/1024) max_chunk 
from dba_free_space 
group by tablespace_name; 

上面的SQL列出了数据库中每个表空间的空闲块情况,如下所示: 

TABLESPACE_NAME CHUNKS MAX_CHUNK 
-------------------- ---------- ---------- 
INDX 1 57.9921875 
RBS 3 490.992188 
RMAN_TS 1 16.515625 
SYSTEM 1 207.296875 
TEMP 20 70.8046875 
TOOLS 1 11.8359375 
USERS 67 71.3671875
 

其中，CHUNKS列表示表空间中有多少可用的空闲块(每个空闲块是由一些连续的Oracle数据块组成)，如果这样的空闲块过多，比如平均到每个数据文件上超过了100个，那么该表空间的碎片状况就比较严重了，可以尝试用以下的SQL命令进行表空间相邻碎片的接合: 

alter tablespace 表空间名 coalesce; 

然后再执行查看表空间碎片的SQL语句，看表空间的碎片有没有减少。如果没有效果，并且表空间的碎片已经严重影响到了数据库的运行，则考虑对该表空间进行重建。 

MAX_CHUNK列的结果是表空间上最大的可用块大小，如果该表空间上的对象所需分配的空间(NEXT值)大于可用块的大小的话，就会提示ORA-1652、ORA-1653、ORA-1654的错误信息，DBA应该及时对表空间的空间进行扩充，以避免这些错误发生。 

对表空间的扩充对表空间的数据文件大小进行扩展，或向表空间增加数据文件，具体操作见“存储管理”部份。 

三、查看数据库的连接情况 

DBA要定时对数据库的连接情况进行检查，看与数据库建立的会话数目是不是正常，如果建立了过多的连接，会消耗数据库的资源。同时，对一些“挂死”的连接，可能会需要DBA手工进行清理。 

以下的SQL语句列出当前数据库建立的会话情况: 

select sid,serial#,username,program,machine,status 
from v$session;
 

输出结果为: 

SID SERIAL# USERNAME PROGRAM MACHINE STATUS 
---- ------- ---------- ----------- --------------- -------- 
1 1 ORACLE.EXE WORK3 ACTIVE 
2 1 ORACLE.EXE WORK3 ACTIVE 
3 1 ORACLE.EXE WORK3 ACTIVE 
4 1 ORACLE.EXE WORK3 ACTIVE 
5 3 ORACLE.EXE WORK3 ACTIVE 
6 1 ORACLE.EXE WORK3 ACTIVE 
7 1 ORACLE.EXE WORK3 ACTIVE 
8 27 SYS SQLPLUS.EXE WORKGROUP\WORK3 ACTIVE 
11 5 DBSNMP dbsnmp.exe WORKGROUP\WORK3 INACTIVE 

其中， 

SID 会话(session)的ID号; 

SERIAL# 会话的序列号，和SID一起用来唯一标识一个会话; 

USERNAME 建立该会话的用户名; 

PROGRAM 这个会话是用什么工具连接到数据库的; 

STATUS 当前这个会话的状态，ACTIVE表示会话正在执行某些任务，INACTIVE表示当前会话没有执行任何操作; 

如果DBA要手工断开某个会话，则执行: 

alter system kill session 'SID,SERIAL#'; 

注意，上例中SID为1到7(USERNAME列为空)的会话，是Oracle的后台进程，不要对这些会话进行任何操作。 

四、控制文件的备份 

在数据库结构发生变化时，如增加了表空间，增加了数据文件或重做日志文件这些操作，都会造成Oracle数据库控制文件的变化，DBA应及进行控制文件的备份，备份方法是: 

执行SQL语句: 

alter database 
backup controlfile to '/home/backup/control.bak'; 

或: 

alter database 
backup controlfile to trace; 

这样，会在USER_DUMP_DEST(初始化参数文件中指定)目录下生成创建控制文件的SQL命令。 

五、检查数据库文件的状态 

DBA要及时查看数据库中数据文件的状态(如被误删除)，根据实际情况决定如何进行处理，检查数据文件的状态的SQL如下: 

select file_name,status 
from dba_data_files;
 

如果数据文件的STATUS列不是AVAILABLE，那么就要采取相应的措施，如对该数据文件进行恢复操作，或重建该数据文件所在的表空间。
